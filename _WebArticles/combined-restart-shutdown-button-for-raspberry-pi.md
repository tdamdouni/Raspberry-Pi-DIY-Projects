# Combined Restart / Shutdown Button for Raspberry Pi

_Captured: 2017-10-22 at 12:17 from [scruss.com](http://scruss.com/blog/2017/10/21/combined-restart-shutdown-button-for-raspberry-pi/)_

A very simple systemd service for Raspberry Pi that provides a software-controlled restart / shutdown button. Code: [scruss/shutdown_button](https://github.com/scruss/shutdown_button)

## Use

Default behaviour is:

  * your Raspberry Pi will _reset_ if the button is held for more than two seconds but fewer than five seconds;
  * your Raspberry Pi will _shut down_ if the button is held for more than five seconds.

By default, the software assumes the switch is connected to pin [BCM 27](https://pinout.xyz/pinout/pin13_gpio27#). Both the pin and the timing can be changed in the Python source file.

## Requirements

### Hardware

  * A Raspberry Pi (tested on a model 2B, 3B and Zero)
  * A normally open, momentary contact button. I use surplus ATX power buttons (as used on desktop PCs), as they're cheap and come with a handy set of wires and header connectors. Virtually any button will do the job, though. Just make sure it's normally open (push to close).![](http://scruss.com/wordpress/wp-content/uploads/2017/10/atx_power2.jpg)

### Software

  * A Debian-based operating system that uses systemd (tested on Wheezy [RetroPie] and Stretch)
  * the `python3-gpiozero` package to provide [GPIO Zero](https://gpiozero.readthedocs.io/en/stable/) (tested on version 1.4.0)

## Installation

### Hardware

Connect the button between GPIO 27 and GND. If you use an ATX power button and a Raspberry Pi with a 40-pin GPIO header, connect it across the seventh column from the left:
    
    
                -
    · · · · · ·|·|· · · · · · · · · · · · · 
    · · · · · ·|·|· · · · · · · · · · · · · 
                -
    

![](http://scruss.com/wordpress/wp-content/uploads/2017/10/gpio.jpg)

This shorts GPIO 27 (physical pin 13) to ground (physical pin 14) when the button is pressed.

### Software

The software is installed with the following commands:
    
    
    sudo apt-install python3-gpiozero
    sudo mkdir -p /usr/local/bin
    chmod +x shutdown_button.py
    sudo cp shutdown_button.py /usr/local/bin
    sudo cp shutdown_button.service /etc/systemd/system
    sudo systemctl enable shutdown_button.service
    sudo systemctl start shutdown_button.service
    

## Troubleshooting

Enabling the service should produce output very similar to:
    
    
    Created symlink /etc/systemd/system/multi-user.target.wants/shutdown_button.service → /etc/systemd/system/shutdown_button.service.
    

You can check the status of the program at any time with the command:
    
    
    systemctl status shutdown_button.service
    

This should produce output similar to:
    
    
    ● shutdown_button.service - GPIO shutdown button
       Loaded: loaded (/etc/systemd/system/shutdown_button.service; enabled; vendor 
       Active: active (running) since Sat 2017-10-21 11:20:56 EDT; 27s ago
     Main PID: 3157 (python3)
       CGroup: /system.slice/shutdown_button.service
               └─3157 /usr/bin/python3 /usr/local/bin/shutdown_button.py
    
    Oct 21 11:20:56 naan systemd[1]: Started GPIO shutdown button.
    

If you're seeing anything _other_ than **Active: active (running)**, it's not working. Does the Python script have the right permissions? Is it in the right place? If you modified the script, did you check it for syntax errors?

The output from `dmesg` will show you any error messages generated by the service.

## Modifications

If you use a HAT/pHAT/Bonnet/etc. with your Raspberry Pi, check [pinout.xyz](https://pinout.xyz/) to see if it uses BCM 27. If you do need to change the pin, best to pick one that doesn't have a useful system service like serial I/O or SPI. If you're using an ATX button with a two pin connector, make sure you choose a pin physically adjacent to a ground pin.

If you modify the timing, please ensure that you keep the shutdown button press duration _longer_ than the reboot one. Otherwise you'll only be able to shut down.

## Notes

You should not need to reboot to enable the service. One machine of mine -- a Raspberry Pi Zero running Raspbian Stretch -- did need a reboot before the button worked.

The reboot code is based on the [Shutdown button](https://gpiozero.readthedocs.io/en/stable/recipes.html#shutdown-button) example from the GPIO Zero documentation.

This is not the only combined shutdown/reset button project to use GPIO Zero. [gilyes/pi-shutdown](https://github.com/gilyes/pi-shutdown) also does so, but pre-dates the implementation of the various hold time functions in GPIO Zero.

GPIO 27 was used, as it's broken out onto a physical button on the Adafruit [PiTFT+](http://adafru.it/2423) display I own.

This is my first systemd service, and I'm still at the "amazed it works at all" stage. The service file may not contain the ideal configuration.
